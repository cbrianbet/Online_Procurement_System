!function(){var e;(e=angular.module("ngImgCrop",[])).factory("cropAreaCircle",["cropArea",function(e){var t=function(){e.apply(this,arguments),this._boxResizeBaseSize=20,this._boxResizeNormalRatio=.9,this._boxResizeHoverRatio=1.2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio,this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._boxResizeIsHover=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!1,this._areaIsDragging=!1};return(t.prototype=new e)._calcCirclePerimeterCoords=function(e){var t=this._width/2,i=Math.floor(this._aspect[1]*(this._width/2)/this._aspect[0]),a=e*(Math.PI/180);return[this._x+t*Math.cos(a),this._y+i*Math.sin(a)]},t.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},t.prototype._isCoordWithinArea=function(e){return Math.sqrt((e[0]-this._x)*(e[0]-this._x)+(e[1]-this._y)*(e[1]-this._y))<this._width/2},t.prototype._isCoordWithinBoxResize=function(e){var t=this._calcResizeIconCenterCoords(),i=this._boxResizeHoverSize/2;return e[0]>t[0]-i&&e[0]<t[0]+i&&e[1]>t[1]-i&&e[1]<t[1]+i},t.prototype._drawArea=function(e,t,i,a){var o=t[0]-i/2,r=t[1]-a/2,n=i/2*.5522848,s=a/2*.5522848,l=o+i,c=r+a,p=o+i/2,h=r+a/2;e.beginPath(),e.moveTo(o,h),e.bezierCurveTo(o,h-s,p-n,r,p,r),e.bezierCurveTo(p+n,r,l,h-s,l,h),e.bezierCurveTo(l,h+s,p+n,c,p,c),e.bezierCurveTo(p-n,c,o,h+s,o,h),e.stroke()},t.prototype.draw=function(){e.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio),this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},t.prototype.processMouseMove=function(e,t){var i="default",a=!1,o=this._ctx.canvas.height,r=this._ctx.canvas.width;if(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)this._x=e-this._posDragStartX,this._y=t-this._posDragStartY,this._areaIsHover=!0,i="move",a=!0,this._events.trigger("area-move");else if(this._boxResizeIsDragging){i="nesw-resize";var n=e-this._posResizeStartX,s=this._posResizeStartSize+n,l=this._width,c=this._height,p=this.getScale(),h=Math.ceil(p*this._minSize),u=Math.max(h,this._unscaledMinSize,s),d=Math.floor(this._aspect[1]*u/this._aspect[0]);if(u<=r&&d<=o){this._width=u,this._height=d;var g=(this._width-l)/2,f=(this._height-c)/2;this._x+=g,this._y+=-1*f,this._boxResizeIsHover=!0,a=!0,this._events.trigger("area-resize")}}else this._isCoordWithinBoxResize([e,t])?(i="nesw-resize",this._areaIsHover=!1,this._boxResizeIsHover=!0,a=!0):this._isCoordWithinArea([e,t])&&(i="move",this._areaIsHover=!0,a=!0);return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:i}),a},t.prototype.processMouseDown=function(e,t){this._isCoordWithinBoxResize([e,t])?(this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartSize=this._width,this._events.trigger("area-resize-start")):this._isCoordWithinArea([e,t])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1,this._posDragStartX=e-this._x,this._posDragStartY=t-this._y,this._events.trigger("area-move-start"))},t.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},t}]),e.factory("cropAreaSquare",["cropArea",function(e){var t=function(){e.apply(this,arguments),this._resizeCtrlBaseRadius=10,this._resizeCtrlNormalRatio=.75,this._resizeCtrlHoverRatio=1,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartWidth=0,this._posResizeStartHeight=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return(t.prototype=new e)._calcSquareCorners=function(){var e=this._width/2,t=this._height/2;return[[this._x-e,this._y-t],[this._x+e,this._y-t],[this._x-e,this._y+t],[this._x+e,this._y+t]]},t.prototype._calcSquareDimensions=function(){var e=this._width/2,t=this._height/2;return{left:this._x-e,top:this._y-t,right:this._x+e,bottom:this._y+t}},t.prototype._isCoordWithinArea=function(e){var t=this._calcSquareDimensions();return e[0]>=t.left&&e[0]<=t.right&&e[1]>=t.top&&e[1]<=t.bottom},t.prototype._isCoordWithinResizeCtrl=function(e){for(var t=this._calcSquareCorners(),i=-1,a=0,o=t.length;a<o;a++){var r=t[a];if(e[0]>r[0]-this._resizeCtrlHoverRadius&&e[0]<r[0]+this._resizeCtrlHoverRadius&&e[1]>r[1]-this._resizeCtrlHoverRadius&&e[1]<r[1]+this._resizeCtrlHoverRadius){i=a;break}}return i},t.prototype._drawArea=function(e,t,i,a){var o=i/2,r=a/2;e.rect(t[0]-o,t[1]-r,i,a)},t.prototype.draw=function(){e.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var t=this._calcSquareCorners(),i=0,a=t.length;i<a;i++){var o=t[i];this._cropCanvas.drawIconResizeCircle(o,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},t.prototype.processMouseMove=function(e,t){var i="default",a=!1,o=this._ctx.canvas.height,r=this._ctx.canvas.width;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=e-this._posDragStartX,this._y=t-this._posDragStartY,this._areaIsHover=!0,i="move",a=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){var n,s;switch(this._resizeCtrlIsDragging){case 0:n=-1,s=-1,i="nwse-resize";break;case 1:n=1,s=-1,i="nesw-resize";break;case 2:n=-1,s=1,i="nesw-resize";break;case 3:n=1,s=1,i="nwse-resize"}var l=(e-this._posResizeStartX)*n,c=this._posResizeStartWidth+l,p=this._width,h=this._height,u=this.getScale(),d=Math.ceil(u*this._minSize),g=Math.max(d,this._unscaledMinSize,c),f=Math.floor(this._aspect[1]*g/this._aspect[0]);if(g<=r&&f<=o){this._width=g,this._height=f;var m=(this._width-p)/2,v=(this._height-h)/2;this._x+=m*n,this._y+=v*s,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,a=!0,this._events.trigger("area-resize")}}else{var _=this._isCoordWithinResizeCtrl([e,t]);if(_>-1){switch(_){case 0:i="nwse-resize";break;case 1:case 2:i="nesw-resize";break;case 3:i="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=_,a=!0}else this._isCoordWithinArea([e,t])&&(i="move",this._areaIsHover=!0,a=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:i}),a},t.prototype.processMouseDown=function(e,t){var i=this._isCoordWithinResizeCtrl([e,t]);i>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=i,this._resizeCtrlIsHover=i,this._posResizeStartX=e,this._posResizeStartY=t,this._posResizeStartWidth=this._width,this._posResizeStartHeight=this._height,this._events.trigger("area-resize-start")):this._isCoordWithinArea([e,t])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=e-this._x,this._posDragStartY=t-this._y,this._events.trigger("area-move-start"))},t.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},t}]),e.factory("cropArea",["cropCanvas",function(e){var t=function(t,i){this._ctx=t,this._events=i,this._minSize=80,this._unscaledMinSize=40,this._cropCanvas=new e(t),this._image=new Image,this._x=0,this._y=0,this._width=200,this._aspect=[1,1],this._height=Math.floor(this._aspect[1]*this._width/this._aspect[0])};return t.prototype.getImage=function(){return this._image},t.prototype.setImage=function(e){this._image=e},t.prototype.getX=function(){return this._x},t.prototype.setX=function(e){this._x=e,this._dontDragOutside()},t.prototype.getY=function(){return this._y},t.prototype.setY=function(e){this._y=e,this._dontDragOutside()},t.prototype.getSize=function(){return this._width},t.prototype.setSize=function(e){var t=this.getScale(),i=Math.round(t*this._minSize);this._width=Math.max(i,this._unscaledMinSize,e),this._height=Math.floor(this._aspect[1]*this._width/this._aspect[0]),this._dontDragOutside()},t.prototype.getWidth=function(){return this._width},t.prototype.setWidth=function(e){this.setSize(e)},t.prototype.getHeight=function(){return this._height},t.prototype.setHeight=function(e){var t=Math.floor(this._aspect[1]*this._minSize/this._aspect[0]),i=Math.max(t,e),a=Math.floor(this._aspect[0]*i/this._aspect[1]);this.setSize(a)},t.prototype.getMinSize=function(){return this._minSize},t.prototype.setMinSize=function(e){this._minSize=e,this._width=Math.max(this._minSize,this._width),this._height=Math.floor(this._aspect[1]*this._width/this._aspect[0]),this._dontDragOutside()},t.prototype.getAspect=function(){return this._aspect},t.prototype.setAspect=function(e,t){this._aspect=[e,t],this._dontDragOutside()},t.prototype.getScale=function(){var e=this._ctx.canvas.width/this._image.width,t=this._ctx.canvas.height/this._image.height;return!isNaN(e)&&!isNaN(t)&&isFinite(e)&&isFinite(t)||(e=1,t=1),Math.max(e,t)},t.prototype._dontDragOutside=function(){var e=this._ctx.canvas.height,t=this._ctx.canvas.width;this._width>t&&(this._width=t),this._height>e&&(this._height=e),this._x<this._width/2&&(this._x=this._width/2),this._x>t-this._width/2&&(this._x=t-this._width/2),this._y<this._height/2&&(this._y=this._height/2),this._y>e-this._height/2&&(this._y=e-this._height/2)},t.prototype._drawArea=function(){},t.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._width,this._height,this._drawArea)},t.prototype.processMouseMove=function(){},t.prototype.processMouseDown=function(){},t.prototype.processMouseUp=function(){},t}]),e.factory("cropCanvas",[function(){var e=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],t=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],i=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],a=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],o=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],r=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],n=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],s=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],l="#fff",c="#fff",p="#444",h="#fff",u="#fff",d="#444",g="#fff";return function(f){var m=function(e,t,i){return[i*e[0]+t[0],i*e[1]+t[1]]},v=function(e,t,i,a){f.save(),f.fillStyle=t,f.beginPath();var o,r=m(e[0],i,a);for(var n in f.moveTo(r[0],r[1]),e)n>0&&(o=m(e[n],i,a),f.lineTo(o[0],o[1]));f.lineTo(r[0],r[1]),f.fill(),f.closePath(),f.restore()};this.drawIconMove=function(e,t){v(o,g,e,t),v(r,g,e,t),v(n,g,e,t),v(s,g,e,t)},this.drawIconResizeCircle=function(e,t,i){var a=t*i;f.save(),f.strokeStyle=u,f.lineWidth=2,f.fillStyle=d,f.beginPath(),f.arc(e[0],e[1],a,0,2*Math.PI),f.fill(),f.stroke(),f.closePath(),f.restore()},this.drawIconResizeBoxBase=function(e,t,i){var a=t*i;f.save(),f.strokeStyle=c,f.lineWidth=2,f.fillStyle=p,f.fillRect(e[0]-a/2,e[1]-a/2,a,a),f.strokeRect(e[0]-a/2,e[1]-a/2,a,a),f.restore()},this.drawIconResizeBoxNESW=function(e,a,o){this.drawIconResizeBoxBase(e,a,o),v(t,h,e,o),v(i,h,e,o)},this.drawIconResizeBoxNWSE=function(t,i,o){this.drawIconResizeBoxBase(t,i,o),v(e,h,t,o),v(a,h,t,o)},this.drawCropArea=function(e,t,i,a,o){var r=e.width/f.canvas.width,n=e.height/f.canvas.height,s=t[0]-i/2,c=t[1]-a/2;for(f.save(),f.strokeStyle=l,f.lineWidth=2,f.beginPath(),o(f,t,i,a),f.stroke(),f.clip();i*r>e.width;)i--;for(;a*n>e.height;)a--;i>0&&a>0&&f.drawImage(e,s*r,c*n,i*r,a*n,s,c,i,a),f.beginPath(),o(f,t,i,a),f.stroke(),f.clip(),f.restore()}}}]),e.service("cropEXIF",[function(){var e=!1,t=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},i=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},a=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},o=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function r(e){return!!e.exifdata}function n(t,i){function a(a){var o=s(a),r=function(t){var i=new DataView(t);if(e&&console.log("Got file of length "+t.byteLength),255!==i.getUint8(0)||216!==i.getUint8(1))return e&&console.log("Not a valid JPEG"),!1;for(var a=2,o=t.byteLength,r=function(e,t){return 56===e.getUint8(t)&&66===e.getUint8(t+1)&&73===e.getUint8(t+2)&&77===e.getUint8(t+3)&&4===e.getUint8(t+4)&&4===e.getUint8(t+5)};a<o;){if(r(i,a)){var n=i.getUint8(a+7);n%2!=0&&(n+=1),0===n&&(n=4);var s=a+8+n,l=i.getUint16(a+6+n);return c(t,s,l)}a++}}(a);t.exifdata=o||{},t.iptcdata=r||{},i&&i.call(t)}if(t.src)if(/^data\:/i.test(t.src))a(function(e,t){t=t||e.match(/^data\:([^\;]+)\;base64,/im)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var i=atob(e),a=i.length,o=new ArrayBuffer(a),r=new Uint8Array(o),n=0;n<a;n++)r[n]=i.charCodeAt(n);return o}(t.src));else if(/^blob\:/i.test(t.src))(r=new FileReader).onload=function(e){a(e.target.result)},function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=function(e){200!==this.status&&0!==this.status||t(this.response)},i.send()}(t.src,function(e){r.readAsArrayBuffer(e)});else{var o=new XMLHttpRequest;o.onload=function(){if(200!==this.status&&0!==this.status)throw"Could not load image";a(o.response),o=null},o.open("GET",t.src,!0),o.responseType="arraybuffer",o.send(null)}else if(window.FileReader&&(t instanceof window.Blob||t instanceof window.File)){var r;(r=new FileReader).onload=function(t){e&&console.log("Got file of length "+t.target.result.byteLength),a(t.target.result)},r.readAsArrayBuffer(t)}}function s(t){var i=new DataView(t);if(e&&console.log("Got file of length "+t.byteLength),255!==i.getUint8(0)||216!==i.getUint8(1))return e&&console.log("Not a valid JPEG"),!1;for(var a,o=2,r=t.byteLength;o<r;){if(255!==i.getUint8(o))return e&&console.log("Not a valid marker at offset "+o+", found: "+i.getUint8(o)),!1;if(a=i.getUint8(o+1),e&&console.log(a),225===a)return e&&console.log("Found 0xFFE1 marker"),d(i,o+4,i.getUint16(o+2));o+=2+i.getUint16(o+2)}}var l={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};function c(e,t,i){for(var a,o,r,n,s=new DataView(e),c={},p=t;p<t+i;)28===s.getUint8(p)&&2===s.getUint8(p+1)&&(n=s.getUint8(p+2))in l&&(r=s.getInt16(p+3),o=l[n],a=u(s,p+5,r),c.hasOwnProperty(o)?c[o]instanceof Array?c[o].push(a):c[o]=[c[o],a]:c[o]=a),p++;return c}function p(t,i,a,o,r){var n,s,l,c=t.getUint16(a,!r),p={};for(l=0;l<c;l++)n=a+12*l+2,!(s=o[t.getUint16(n,!r)])&&e&&console.log("Unknown tag: "+t.getUint16(n,!r)),p[s]=h(t,n,i,0,r);return p}function h(e,t,i,a,o){var r,n,s,l,c,p,h=e.getUint16(t+2,!o),d=e.getUint32(t+4,!o),g=e.getUint32(t+8,!o)+i;switch(h){case 1:case 7:if(1===d)return e.getUint8(t+8,!o);for(r=d>4?g:t+8,n=[],l=0;l<d;l++)n[l]=e.getUint8(r+l);return n;case 2:return u(e,r=d>4?g:t+8,d-1);case 3:if(1===d)return e.getUint16(t+8,!o);for(r=d>2?g:t+8,n=[],l=0;l<d;l++)n[l]=e.getUint16(r+2*l,!o);return n;case 4:if(1===d)return e.getUint32(t+8,!o);for(n=[],l=0;l<d;l++)n[l]=e.getUint32(g+4*l,!o);return n;case 5:if(1===d)return c=e.getUint32(g,!o),p=e.getUint32(g+4,!o),(s=new Number(c/p)).numerator=c,s.denominator=p,s;for(n=[],l=0;l<d;l++)c=e.getUint32(g+8*l,!o),p=e.getUint32(g+4+8*l,!o),n[l]=new Number(c/p),n[l].numerator=c,n[l].denominator=p;return n;case 9:if(1===d)return e.getInt32(t+8,!o);for(n=[],l=0;l<d;l++)n[l]=e.getInt32(g+4*l,!o);return n;case 10:if(1===d)return e.getInt32(g,!o)/e.getInt32(g+4,!o);for(n=[],l=0;l<d;l++)n[l]=e.getInt32(g+8*l,!o)/e.getInt32(g+4+8*l,!o);return n}}function u(e,t,i){for(var a="",o=t;o<t+i;o++)a+=String.fromCharCode(e.getUint8(o));return a}function d(r,n){if("Exif"!==u(r,n,4))return e&&console.log("Not valid EXIF data! "+u(r,n,4)),!1;var s,l,c,h,d,g=n+6;if(18761===r.getUint16(g))s=!1;else{if(19789!==r.getUint16(g))return e&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;s=!0}if(42!==r.getUint16(g+2,!s))return e&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var f=r.getUint32(g+4,!s);if(f<8)return e&&console.log("Not valid TIFF data! (First offset less than 8)",r.getUint32(g+4,!s)),!1;if((l=p(r,g,g+f,i,s)).ExifIFDPointer)for(c in h=p(r,g,g+l.ExifIFDPointer,t,s)){switch(c){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":h[c]=o[c][h[c]];break;case"ExifVersion":case"FlashpixVersion":h[c]=String.fromCharCode(h[c][0],h[c][1],h[c][2],h[c][3]);break;case"ComponentsConfiguration":h[c]=o.Components[h[c][0]]+o.Components[h[c][1]]+o.Components[h[c][2]]+o.Components[h[c][3]]}l[c]=h[c]}if(l.GPSInfoIFDPointer)for(c in d=p(r,g,g+l.GPSInfoIFDPointer,a,s)){switch(c){case"GPSVersionID":d[c]=d[c][0]+"."+d[c][1]+"."+d[c][2]+"."+d[c][3]}l[c]=d[c]}return l}this.getData=function(e,t){return!((e instanceof Image||e instanceof HTMLImageElement)&&!e.complete||(r(e)?t&&t.call(e):n(e,t),0))},this.getTag=function(e,t){if(r(e))return e.exifdata[t]},this.getAllTags=function(e){if(!r(e))return{};var t,i=e.exifdata,a={};for(t in i)i.hasOwnProperty(t)&&(a[t]=i[t]);return a},this.pretty=function(e){if(!r(e))return"";var t,i=e.exifdata,a="";for(t in i)i.hasOwnProperty(t)&&("object"==typeof i[t]?i[t]instanceof Number?a+=t+" : "+i[t]+" ["+i[t].numerator+"/"+i[t].denominator+"]\r\n":a+=t+" : ["+i[t].length+" values]\r\n":a+=t+" : "+i[t]+"\r\n");return a},this.readFromBinaryFile=function(e){return s(e)}}]),e.factory("cropHost",["$document","$window","cropAreaCircle","cropAreaSquare","cropEXIF",function(e,t,i,a,o){var r=function(i){var a=i.getBoundingClientRect(),o=e[0].body,r=e[0].documentElement,n=t.pageYOffset||r.scrollTop||o.scrollTop,s=t.pageXOffset||r.scrollLeft||o.scrollLeft,l=r.clientTop||o.clientTop||0,c=r.clientLeft||o.clientLeft||0,p=a.top+n-l,h=a.left+s-c;return{top:Math.round(p),left:Math.round(h)}};return function(t,o,n){var s=null,l=null,c=null,p=[100,100],h=[300,300],u=200,d=[1,1],g=u,f=Math.floor(d[1]*g/d[0]),m="image/png",v=null;function _(){s.clearRect(0,0,s.canvas.width,s.canvas.height),null!==l&&(s.drawImage(l,0,0,s.canvas.width,s.canvas.height),s.save(),s.fillStyle="rgba(0, 0, 0, 0.65)",s.fillRect(0,0,s.canvas.width,s.canvas.height),s.restore(),c.draw())}var I=function(e,i){if(null!==l){c.setImage(l);var a,o,r,n,u=[l.width,l.height],g=l.width/l.height,f=u;if(f[0]>h[0]?(f[0]=h[0],f[1]=f[0]/g):f[0]<p[0]&&(f[0]=p[0],f[1]=f[0]/g),f[1]>h[1]?(f[1]=h[1],f[0]=f[1]*g):f[1]<p[1]&&(f[1]=p[1],f[0]=f[1]*g),t.prop("width",f[0]).prop("height",f[1]).css({"margin-left":-f[0]/2+"px","margin-top":-f[1]/2+"px"}),a=s.canvas.width/2,o=s.canvas.height/2,e?(r=s.canvas.width-1,n=Math.floor(d[1]*r/d[0])):(r=.75*s.canvas.width,(n=Math.floor(d[1]*r/d[0]))>.75*s.canvas.height&&(n=.75*s.canvas.height,r=Math.floor(d[0]*n/d[1]))),void 0!==i&&void 0!==i.width&&i.width>0){var m=s.canvas.width/l.width;(r=Math.round(i.width*m))>s.canvas.width&&(r=s.canvas.width-1),n=Math.floor(d[1]*r/d[0]),a=Math.round(i.x*m+r/2),o=Math.round(i.y*m+n/2)}n>s.canvas.height&&(n=s.canvas.height-1,r=Math.floor(d[0]*n/d[1])),a+r/2>s.canvas.width&&(a=Math.floor(s.canvas.width-r/2)),o+n/2>s.canvas.height&&(o=Math.floor(s.canvas.height-n/2)),c.setX(a),c.setY(o),c.setSize(r)}else t.prop("width",0).prop("height",0).css({"margin-top":0});_()},w=function(e){return angular.isDefined(e.changedTouches)?e.changedTouches:e.originalEvent.changedTouches},y=function(e){if(null!==l){var t,i,a=r(s.canvas);"touchmove"===e.type?(t=w(e)[0].pageX,i=w(e)[0].pageY):(t=e.pageX,i=e.pageY),c.processMouseMove(t-a.left,i-a.top),_()}},S=function(e){if(e.preventDefault(),e.stopPropagation(),null!==l){var t,i,a=r(s.canvas);"touchstart"===e.type?(t=w(e)[0].pageX,i=w(e)[0].pageY):(t=e.pageX,i=e.pageY),c.processMouseDown(t-a.left,i-a.top),_()}},F=function(e){if(null!==l){var t,i,a=r(s.canvas);"touchend"===e.type?(t=w(e)[0].pageX,i=w(e)[0].pageY):(t=e.pageX,i=e.pageY),c.processMouseUp(t-a.left,i-a.top),_()}};this.getResultImageDataURI=function(){var e,t;if(e=(t=angular.element("<canvas></canvas>")[0]).getContext("2d"),t.width=g,t.height=f,null!==l){for(var i=c.getWidth(),a=c.getHeight(),o=l.width/s.canvas.width,r=l.height/s.canvas.height,n=c.getX()-i/2,p=c.getY()-a/2;i*o>l.width;)i--;for(;a*r>l.height;)a--;e.drawImage(l,n*o,p*r,i*o,a*r,0,0,g,f)}return null!==v?t.toDataURL(m,v):t.toDataURL(m)},this.setNewImageSource=function(e,t,i){if(l=null,I(t),n.trigger("image-updated"),e){var a=new Image;"http"===e.substring(0,4).toLowerCase()&&(a.crossOrigin="anonymous"),a.onload=function(){n.trigger("load-done"),l=a,I(t,i),n.trigger("image-updated")},a.onerror=function(){n.trigger("load-error")},n.trigger("load-start"),a.src=e}},this.setMaxDimensions=function(e,i){if(h=[e,i],null!==l){if(t[0].clientHeight>0){var a=s.canvas.width,o=s.canvas.height,r=[l.width,l.height],n=l.width/l.height,u=r;u[0]>h[0]?(u[0]=h[0],u[1]=u[0]/n):u[0]<p[0]&&(u[0]=p[0],u[1]=u[0]/n),u[1]>h[1]?(u[1]=h[1],u[0]=u[1]*n):u[1]<p[1]&&(u[1]=p[1],u[0]=u[1]*n),t.prop("width",u[0]).prop("height",u[1]).css({"margin-left":-u[0]/2+"px","margin-top":-u[1]/2+"px"});var d=s.canvas.width/a,g=s.canvas.height/o,f=Math.min(d,g);c.setX(c.getX()*d),c.setY(c.getY()*g),c.setSize(c.getSize()*f)}}else t.prop("width",0).prop("height",0).css({"margin-top":0});_()},this.setAreaMinSize=function(e){e=parseInt(e,10),isNaN(e)||(c.setMinSize(e),_())},this.setResultImageSize=function(e){e=parseInt(e,10),isNaN(e)||(g=u=e,f=Math.floor(d[1]*g/d[0]))},this.setResultImageAspect=function(e,t){if(e=parseInt(e,10),t=parseInt(t,10),!isNaN(e)&&!isNaN(t)){c.setAspect(e,t);var i=c.getWidth();c.setSize(i),d=[e,t],f=Math.floor(d[1]*g/d[0])}},this.setResultImageFormat=function(e){m=e},this.setResultImageQuality=function(e){e=parseFloat(e),!isNaN(e)&&e>=0&&e<=1&&(v=e)},this.setAreaType=function(e){var t=c.getSize(),o=c.getMinSize(),r=c.getX(),p=c.getY(),h=c.getAspect(),u=i;"square"===e&&(u=a),(c=new u(s,n)).setAspect(h[0],h[1]),c.setMinSize(o),c.setSize(t),c.setX(r),c.setY(p),null!==l&&c.setImage(l),_()},this.getArea=function(){return c},this.getCanvas=function(){return s.canvas},this.getImageWidth=function(){return null!==l?l.width:0},this.getImageHeight=function(){return null!==l?l.height:0},s=t[0].getContext("2d"),c=new i(s,n),e.on("mousemove",y),t.on("mousedown",S),e.on("mouseup",F),e.on("touchmove",y),t.on("touchstart",S),e.on("touchend",F),this.destroy=function(){e.off("mousemove",y),t.off("mousedown",S),e.off("mouseup",y),e.off("touchmove",y),t.off("touchstart",S),e.off("touchend",y),t.remove()}}}]),e.factory("cropPubSub",[function(){return function(){var e={};this.on=function(t,i){return t.split(" ").forEach(function(t){e[t]||(e[t]=[]),e[t].push(i)}),this},this.trigger=function(t,i){return angular.forEach(e[t],function(e){e.call(null,i)}),this}}}]),e.directive("imgCrop",["$timeout","cropHost","cropPubSub",function(e,t,i){return{restrict:"E",scope:{image:"=",resultImage:"=",originalData:"=",cropData:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageAspect:"@",resultImageFormat:"@",resultImageQuality:"=",maximizeCrop:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function(e){e.events=new i}],link:function(i,a,o){var r,n=i.events,s=!0,l=new t(a.find("canvas"),{},n),c=function(e){if(""!==e.image){var t=l.getImageWidth(),i=l.getImageHeight(),a=l.getArea(),o=l.getCanvas(),n=a.getAspect();if(Math.floor(a.getWidth()*n[1]/n[0])>o.height&&a.setHeight(o.height),angular.isDefined(e.cropData)&&0!==t){var s=t/o.width;e.cropData={width:Math.round(a.getWidth()*s),height:Math.round(a.getHeight()*s),x:Math.round((a.getX()-a.getWidth()/2)*s),y:Math.round((a.getY()-a.getHeight()/2)*s)}}if(angular.isDefined(e.originalData)&&0!==t&&0!==i&&(e.originalData={width:t,height:i}),angular.isDefined(e.resultImage)){var c=l.getResultImageDataURI();r!==c&&(r=c,angular.isDefined(e.resultImage)&&(e.resultImage=c),e.onChange({$dataURI:e.resultImage}))}}},p=function(t){return function(){e(function(){i.$apply(function(e){t(e)})})}};n.on("load-start",p(function(e){e.onLoadBegin({})})).on("load-done",p(function(e){e.onLoadDone({})})).on("load-error",p(function(e){e.onLoadError({})})).on("area-move area-resize",p(function(e){e.changeOnFly&&c(e)})).on("area-move-end area-resize-end image-updated",p(function(e){c(e)})),i.$watch("image",function(){var t={};e(function(){var e=!!i.maximizeCrop;angular.isDefined(i.cropData)&&(t=i.cropData),l.setNewImageSource(i.image,e,t)},100)}),i.$watch("areaType",function(){l.setAreaType(i.areaType),c(i)}),i.$watch("areaMinSize",function(){l.setAreaMinSize(i.areaMinSize),c(i)}),i.$watch("resultImageSize",function(){l.setResultImageSize(i.resultImageSize),c(i)}),i.$watch("resultImageAspect",function(){if(void 0!==i.resultImageAspect){var e=i.resultImageAspect.toLowerCase().split("x");2!==e.length||isNaN(parseInt(e[0],10))||isNaN(parseInt(e[1],10))||(l.setResultImageAspect(parseInt(e[0],10),parseInt(e[1],10)),c(i))}}),i.$watch("resultImageFormat",function(){l.setResultImageFormat(i.resultImageFormat),c(i)}),i.$watch("resultImageQuality",function(){l.setResultImageQuality(i.resultImageQuality),c(i)}),i.$watch("maximizeCrop",function(){var e=!!i.maximizeCrop;angular.isDefined(i.image)&&!s?l.setNewImageSource(i.image,e):s=!1}),i.$watch(function(){return[a[0].clientWidth,a[0].clientHeight]},function(e){l.setMaxDimensions(e[0],e[1]),c(i)},!0),i.$on("$destroy",function(){l.destroy()})}}}]),e.directive("imgCropResult",function(){return{restrict:"A",scope:{image:"=",cropData:"=",originalData:"=",width:"@"},template:'<div class="imgCropResultContainer"><img /></div>',link:function(e,t,i){var a,o,r=angular.element(t[0].querySelector(".imgCropResultContainer")),n=t.find("img")[0],s=0,l=0,c=0,p=function(){angular.isDefined(e.image)&&""!==e.image&&angular.isDefined(e.cropData)&&void 0!==e.cropData.width&&h()},h=function(){var t,i=Math.round(100*e.cropData.width/e.cropData.height);i!==o&&(o=i,c=Math.round(1e5*e.cropData.height/e.cropData.width)/1e3,r.css({"padding-top":c+"%"})),e.image!==a?(a=e.image,angular.isDefined(e.originalData)&&void 0!==e.originalData.width&&0!==e.originalData.width?(s=e.originalData.width,l=e.originalData.height,u()):((t=new Image).onload=function(){s=t.width,l=t.height,u()},t.src=e.image),n.src=e.image):u()},u=function(){var t=Math.round(1e5*s/e.cropData.width)/1e3,i=Math.round(1e5*l/e.cropData.height)/1e3,a=-1*Math.floor(1e3*t*e.cropData.x/s)/1e3,o=-1*Math.floor(1e3*i*e.cropData.y/l)/1e3;angular.element(n).css({width:t+"%",left:a+"%",top:o+"%"})};e.$watch("image",function(){p()}),e.$watch("cropData",function(){p()}),e.$watch("width",function(){var i=parseFloat(e.width)!==parseInt(e.width)||isNaN(e.width)?"":"px";t.css({width:e.width+i})})}}});const t=angular.module("components.uploading.helpers.image",["ngImgCrop","components.core.utils"]).service("eoImageHelper",i);function i(e,t,i,a,o){function r(e,t,i,a){var o=a.scaleTo,r=a.offsets,n=[3,6,8].indexOf(i)>-1,s=[6,8].indexOf(i)>-1,l=e.getContext("2d"),c={scaleTo:o,offsets:r},p=0;switch(i){case 3:c.offsets.cx=-t.width,c.offsets.cy=-t.height,p=180;break;case 6:c.offsets.cw=t.height,c.offsets.ch=t.width,c.offsets.cy=-t.height,p=90;break;case 8:c.offsets.cw=t.height,c.offsets.ch=t.width,c.offsets.cx=-t.width,p=270}if(angular.isDefined(c.scaleTo)&&(c.offsets.cw>c.offsets.ch?(c.scaleTo>c.offsets.cw&&(c.scaleTo=c.offsets.cw),l.scale(c.scaleTo/c.offsets.cw,c.scaleTo/c.offsets.cw),c.offsets.cx*=c.scaleTo/c.offsets.cw,c.offsets.cy*=c.scaleTo/c.offsets.cw,c.offsets.ch*=c.scaleTo/c.offsets.cw,c.offsets.cw=c.scaleTo):(c.scaleTo>c.offsets.ch&&(c.scaleTo=c.offsets.ch),l.scale(c.scaleTo/c.offsets.ch,c.scaleTo/c.offsets.ch),c.offsets.cx*=c.scaleTo/c.offsets.ch,c.offsets.cy*=c.scaleTo/c.offsets.ch,c.offsets.cw*=c.scaleTo/c.offsets.ch,c.offsets.ch=c.scaleTo)),e.width=c.offsets.cw,e.height=c.offsets.ch,n&&l.rotate(p*(Math.PI/180)),s){var h=[c.offsets.cw,c.offsets.ch];c.offsets.ch=h[0],c.offsets.cw=h[1]}return c}return{dataURItoBlob:function(e,t){for(var i=atob(e.split(",")[1]),a=[],o=i.length,r=0;r<o;r+=1)a.push(i.charCodeAt(r));var n=angular.extend({},t);return new Blob([new window.Uint8Array(a)],n)},applyRotationFromEXIF:function(e,t,o){a.getData(e,function(){var n=a.getTag(e,"Orientation");!function(e,t,a){var o=new Image,n=i[0].createElement("canvas"),s=n.getContext("2d");o.onload=function(){var e={cw:o.width,ch:o.height,cx:0,cy:0},i=r(n,o,t,{scaleTo:void 0,offsets:e});s.drawImage(o,i.offsets.cx,i.offsets.cy);var l=n.toDataURL("image/png");i=r(n,o,t,Object.assign(i,{scaleTo:226})),s.drawImage(o,i.offsets.cx,i.offsets.cy,i.offsets.cw,i.offsets.ch);var c=n.toDataURL("image/png");a&&a(l,c,t)},o.src=e}(t,n,o)})},loadImageByUrl:function(a,r){var n=e.defer(),s=o.parseUrl(a),l=o.parseUrl(i[0].location.href),c=new Image;(r||""!==s.host&&(s.host!==l.host||s.protocol!==l.protocol||s.port!==l.port))&&c.setAttribute("crossOrigin","anonymous"),c.onerror=function(e){n.reject(e)},c.onload=function(){var e=i[0].createElement("canvas");e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0);try{n.resolve(e.toDataURL("image/png"))}catch(e){n.reject(e)}};try{c.src=a,t.$evalAsync(function(){n.notify({})})}catch(e){n.reject(e)}return n.promise}}}i.$inject=["$q","$rootScope","$document","cropEXIF","eoUtils"];const a="components.core.model",o=angular.module("components.uploading.helpers.models",[a]).run(r);function r(e){var t=e.get("Base"),i=e.get("Exception"),a=t.extend({name:"",file:null,progress:-1,response:null,init:function(e){void 0!==e&&this._super(e)}});e.put("FileUpload",a);var o=t.extend({type:"",name:"",size:0,file_key:"",init:function(e){void 0!==e&&this._super(e)}});e.put("WebStorageUpload",o),e.put("UploadTypeException",i.extend({}))}r.$inject=["eoModelRegistry"];const n=angular.module("components.uploading.helpers",[]).service("eoUpload",l).config(s).directive("eoFileSelect",c).directive("eoFileDrop",p);function s(){var e;!window.XMLHttpRequest||window.FileAPI&&window.FileAPI.shouldLoad||(window.XMLHttpRequest.prototype.setRequestHeader=(e=window.XMLHttpRequest.prototype.setRequestHeader,function(t,i){if("$setXHR"===t){var a=i(this);a instanceof Function&&a(this)}else{for(var o=arguments.length,r=Array(o>2?o-2:0),n=2;n<o;n++)r[n-2]=arguments[n];e.apply(this,[t,i].concat(r))}}))}function l(e,t,i){function a(a){var o=Object.assign({},a);o.method=o.method||"POST",o.headers=o.headers||{},o.transformRequest=o.transformRequest||function(t,i){return window.ArrayBuffer&&t instanceof window.ArrayBuffer?t:e.defaults.transformRequest[0](t,i)};var r,n,s=t.defer();return!window.XMLHttpRequest||window.FileAPI&&window.FileAPI.shouldLoad||(o.headers.$setXHR=function(){return function(e){e&&(o.$XHR=e,o.xhrFn&&o.xhrFn.constructor===Function&&o.xhrFn(e),e.upload.addEventListener("progress",function(e){s.notify(e)},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&s.notify(e)},!1))}}),e(o).then(function(e){s.resolve(e)},function(e){s.reject(e)},function(e){s.notify(e)}),s.promise.success=function(e){return s.promise.then(function(t){e(t.data,t.status,t.headers,o)}),s.promise},s.promise.progress=function(e){return s.promise.then(null,null,function(t){e(t)}),s.promise},s.promise.error=function(e){return s.promise.then(null,function(t){e(t.data,t.status,t.headers,o)}),s.promise},s.promise.abort=function(){return o.$XHR&&i(function(){o.$XHR.abort()}),s.promise},s.promise.xhr=function(e){var t;return o.xhrFn=(t=o.xhrFn,function(){for(var i=arguments.length,a=Array(i),o=0;o<i;o++)a[o]=arguments[o];t&&t.apply(s.promise,a),e.apply(s.promise,a)}),s.promise},s.promise.then=(r=s.promise,n=s.promise.then,function(e,t,i){o.progress=i||o.progress;var a=n.apply(r,[e,t,i]);return a.abort=r.abort,a.progress=r.progress,a.xhr=r.xhr,a.then=r.then,a}),s.promise}return{upload:function(t){var i=Object.assign({},t);i.headers=i.headers||{},i.headers["Content-Type"]=void 0,i.transformRequest=i.transformRequest||e.defaults.transformRequest;var o=new FormData,r=i.transformRequest,n=i.data;return i.transformRequest=function(e,t){if(n&&(i.formDataAppender?angular.forEach(n,function(t,a){i.formDataAppender(e,a,t)}):angular.forEach(n,function(i,a){var o=i;if(angular.isFunction(r))o=r(i,t);else for(var n=0;n<r.length;n+=1){var s=r[n];angular.isFunction(s)&&(o=s(i,t))}e.append(a,o)})),null!==i.file){var a=i.fileFormDataName||"file";if(angular.isArray(i.file))for(var o=angular.isString(a),s=0;s<i.file.length;s+=1)e.append(o?a+s:a[s],i.file[s],i.file[s].name);else e.append(a,i.file,i.file.name)}return e},i.data=o,a(i)},http:function(e){return a(e)}}}function c(){return{restrict:"A",scope:{onSelect:"&eoFileSelect"},link:function(e,t){t.on("change",function(t){var i=[],a=t.target.files;null!==a&&Array.prototype.push.apply(i,a),e.$apply(function(){e.onSelect({$files:i,$event:t})})})}}}function p(){return{restrict:"A",scope:{onSelect:"&eoFileDrop"},link:function(e,t){window.FileReader&&(t.on("dragover",function(e){t.addClass("dragover"),e.stopPropagation(),e.preventDefault()}),t.on("dragleave",function(e){t.removeClass("dragover"),e.stopPropagation(),e.preventDefault()}),t.on("drop",function(i){t.removeClass("dragover"),i.stopPropagation(),i.preventDefault();var a=null;i.dataTransfer?a=i.dataTransfer.files:i.originalEvent&&i.originalEvent.dataTransfer&&(a=i.originalEvent.dataTransfer.files);var o=[];null!==a&&Array.prototype.push.apply(o,a),e.$apply(function(){e.onSelect({$event:i,$files:o})})}))}}}s.$inject=[],l.$inject=["$http","$q","$timeout"],c.$inject=[],p.$inject=[];const h='<div class="crop-area"> <img-crop image="image" result-image="resultImage" area-type="{{areaType}}" change-on-fly="changeOnFly" area-min-size="areaMinSize" result-image-size="resultImageSize" result-image-format="{{resultImageFormat}}" result-image-quality="resultImageQuality" result-image-aspect="{{resultImageAspect}}" on-change="onChange" on-load-begin="onLoadBegin" on-load-done="onLoadDone" on-load-error="onLoadError"></img-crop> </div> ';var u=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],a=!0,o=!1,r=void 0;try{for(var n,s=e[Symbol.iterator]();!(a=(n=s.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const d=angular.module("components.uploading.images.crop",["ngImgCrop"]).run(g).constant("PROFILE_IMAGE_CROP_TOOL_COLORS",{areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"}).config(f).directive("eoImageCrop",m).service("eoImageCropCoord",v);function g(e){e.put("ImageCrop.tmpl.html",h)}function f(e,t){e.decorator("cropArea",["$delegate",function(e){var t=!1,i=function(i,a){for(var o=arguments.length,r=Array(o>2?o-2:0),n=2;n<o;n++)r[n-2]=arguments[n];return e.apply(this,[i,a].concat(r)),a&&a.on("image-updated",function(){t=!1}),this};return(i.prototype=new e).draw=function(){!t&&this._cropCanvas.coord&&(this._events.trigger("init-area",this._cropCanvas.coord),t=!0),this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._width,this._aspect,this._drawArea)},i}]),e.decorator("cropAreaSquare",["$delegate",function(e){var t=function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];return e.apply(this,i),this};return(t.prototype=new e).processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end",this._cropCanvas.coord)),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end",this._cropCanvas.coord)),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},t}]),e.decorator("cropAreaCircle",["$delegate",function(e){var t=function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];return e.apply(this,i),this};return(t.prototype=new e).processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end",this._cropCanvas.coord)),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end",this._cropCanvas.coord)),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},t}]),e.decorator("cropCanvas",["$delegate",function(e){var i=function(i){e.call(this,i),this.setCropCoord=function(e,t,i,a){this.coord={x:e,y:t,width:i,height:a}},this.drawCropArea=function(e,a,o,r,n){var s=Math.floor(o*(r[1]/r[0])),l=e.width/i.canvas.width,c=e.height/i.canvas.height,p=a[0]-o/2,h=a[1]-s/2;if(i.save(),i.strokeStyle=t.areaOutline,i.lineWidth=2,i.beginPath(),n(i,a,o,s),i.stroke(),i.clip(),o>0){var u=p*l,d=h*c,g=o*l,f=s*c;i.drawImage(e,u,d,g,f,p,h,o,s),this.setCropCoord(u,d,g,f)}i.beginPath(),n(i,a,o,s),i.stroke(),i.clip(),i.restore()}};return i.prototype=new e,i}]),e.decorator("imgCropDirective",["$delegate","$timeout","eoImageCropCoord",function(e,t,i){var a=u(e,1)[0],o=a.compile;return a.compile=function(e){for(var a=arguments.length,r=Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];var s=o.apply(this,[e].concat(r));return function(e,a,o){for(var r=arguments.length,n=Array(r>3?r-3:0),l=3;l<r;l++)n[l-3]=arguments[l];s.apply(this,[e,a,o].concat(n)),e.events.on("area-move-end area-resize-end",function(a){t(function(){e.$apply(function(){i.set(a),e.cropCoord=a})})}).on("init-area",function(a){t(function(){e.$apply(function(){i.set(a),e.cropCoord=a})})})}},e}])}function m(){return{templateUrl:"ImageCrop.tmpl.html",scope:{image:"=",resultImage:"=",cropCoord:"=?",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageFormat:"@",resultImageQuality:"=",resultImageAspect:"@",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"}}}function v(){var e={};return{set:function(t){return e=t},get:function(){return e}}}g.$inject=["$templateCache"],f.$inject=["$provide","PROFILE_IMAGE_CROP_TOOL_COLORS"],m.$inject=[],v.$inject=[],angular.module("components.uploading.images",[d.name]);var _,I=(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e={};if("undefined"!=typeof Applet){if("function"==typeof Applet.getUser&&null!=Applet.getUser()&&(e.User=Applet.getUser()),"function"==typeof Applet.getOrganization&&null!=Applet.getOrganization()&&(e.Organization=Applet.getOrganization()),"function"==typeof Applet.getVisitorId&&null!=Applet.getVisitorId()){var t={getVisitorId:Applet.getVisitorId};"function"==typeof Applet.getVisitorApiKey&&null!=Applet.getVisitorApiKey()&&(t.getVisitorApiKey=Applet.getVisitorApiKey),e.Visitor=t}"function"==typeof Applet.getVar&&null!=Applet.getVar("urchinId")&&(e.EO={analytics:{urchinId:Applet.getVar("urchinId")}}),"function"==typeof Applet.getInstanceEnv&&(e.Environment=Applet.getInstanceEnv()),e.CsrfTokenHeaderName=Applet.getVar("csrfTokenHeaderName"),e.CsrfTokenCookieName=Applet.getVar("csrfTokenCookieName"),e.PageId=Applet.getVar("pageId"),e.smfAjax=Applet.getVar("smfAjax"),e.ccstCookieName=Applet.getVar("ccstCookieName"),e.disputesASIntegration=Applet.getVar("disputesASIntegration"),e.NotificationASIntegration=Applet.getVar("NotificationASIntegration"),e.XOdeskReferrer=Applet.getVar("XOdeskReferrer")}return e}}(_={exports:{}},_.exports),_.exports);const w=(y=I)&&y.__esModule&&Object.prototype.hasOwnProperty.call(y,"default")?y.default:y;var y;function S(e){var t=w();Object.keys(t).forEach(function(i){e.put(i,t[i])})}function F(e){return e("eoConfig")}S.$inject=["eoConfig"],F.$inject=["$cacheFactory"];const C=angular.module("components.core.config",[]).run(S).factory("eoConfig",F),R="components.core.block",D='<div class="container-fluid file-upload-list"> <ul class="list-unstyled"> <li ng-repeat="file in selectedFiles track by $index"> <div ng-if="!file.error"> <span class="glyphicon-sm o-icon-paperclip"></span> <span ng-if="file.progress < 0 && requestWatch.pending">Wait for it...</span> <span ng-if="file.progress >= 0 && file.progress < 100">Uploaded {{ file.progress }}%...</span> <span ng-if="file.progress == 100"><a href="javascript:;">{{file.file.name}}</a></span> <button type="button" class="close" aria-hidden="true" ng-click="removeSelectedFile($index)">&times;</button> </div> <div ng-if="file.error"> <span class="o-icon-error"></span> <span>Failed to attach "{{file.file.name}}"</span> <button type="button" class="close" aria-hidden="true" ng-click="removeSelectedFile(file.file)">&times;</button> </div> </li> </ul> </div> <button class="btn btn-link btn-popover" eo-popover="FileUploadList.menu.tmpl.html" eo-popover-placement="bottom"> + Attach file </button>',x='<div class="file-upload-menu"> <div class="list-group"> <a href="javascript:;" class="list-group-item"> <input class="upload-button" type="file" eo-file-select="$parent.uploadFile($files)"> <div>Upload file</div> </a> <a href="javascript:;" class="list-group-item" ng-click="$parent.chooseFromDropbox()"> <div class="dropbox-choose">Share via dropbox</div> </a> </div> </div> ',A=angular.module("components.uploading.uploaders.file",[n.name,"components.core.popover","components.core.modal",C.name,R,o.name]).run(b).constant("DROPBOX_APP_KEY","lss047vujjt0bir").constant("FILE_UPLOAD_URL","/api/files/v1/tmp.xhtml").constant("DROPBOX_UPLOAD_URL","/api/files/v1/webstorage.json").directive("eoFileUploadList",z);function b(e){e.put("FileUploadList.tmpl.html",D),e.put("FileUploadList.menu.tmpl.html",x)}function z(e,t,i,a,o,r,n,s,l,c,p){return{restrict:"A",require:"?^form",scope:{onComplete:"&eoFileUploadList",onUpdate:"&eoFileUploadListOnUpdate",preloadedFiles:"="},link:function(e,t,a,s){if(function(){if(!i.Dropbox){var e=p[0].createElement("script");e.type="text/javascript",e.id="dropboxjs",e.setAttribute("data-app-key",n),e.async=!1,e.src="https://www.dropbox.com/static/api/2/dropins.js",p[0].getElementsByTagName("head")[0].appendChild(e)}}(),e.closePopover=function(){setTimeout(function(){t.children().eq(1).triggerHandler("click")},0)},e.requestWatch=new r,s&&e.$watch("requestWatch.pending",function(e){s.$setValidity("uploadingFile",!e)}),e.preloadedFiles&&e.preloadedFiles.length>0){var l=[];angular.forEach(e.preloadedFiles,function(e){var t=new File([""],e.name,e),i=o.get("FileUpload",{file:t,progress:100});l.push(i)}),e.onComplete({$files:l})}},controller:["$scope",function(r){var n=angular.extend(t.get("env")||{},{USER_MAX_FILE_UPLOAD:20971520});r.selectedFiles=[],r.uploadedFiles=[];var p=function(){for(var e=0,t=0;t<r.selectedFiles.length;t+=1)(100===r.selectedFiles[t].progress||r.selectedFiles[t].error)&&(e+=1);r.selectedFiles.length&&r.selectedFiles.length===e&&r.onComplete({$files:r.selectedFiles}),r.onUpdate({$files:r.selectedFiles})};r.$watchCollection("uploadedFiles",p);var h=function(e){return function(t){var i=null;if(t.constructor===String){var a=t.replace(/(<([^>]+)>)/gi,"");i=angular.fromJson(a)}else i=t;r.selectedFiles[e].response=i,201==+i.code?(r.selectedFiles[e].progress=100,r.uploadedFiles.push(r.selectedFiles[e])):400==+i.code?(r.selectedFiles[e].error=i,s.simple({locals:{_header:"Empty attachment",_body:i.message}})):413==+i.code?(r.selectedFiles[e].error=i,s.simple({locals:{_header:"Attachment size limit exceeded",_body:i.message}})):500==+i.code&&(r.selectedFiles[e].error=i,s.simple({locals:{_header:"Internal Server Error",_body:i.message}}))}},u=function(e){return function(t){r.selectedFiles[e].error=t}};r.uploadFile=function(t){angular.forEach(t,function(t){if(t.size<=n.USER_MAX_FILE_UPLOAD){var i=o.get("FileUpload",{file:t,progress:-1,dataUrl:null}),a=r.selectedFiles.push(i)-1;r.requestWatch.wait(e.upload({url:l,file:t,fileFormDataName:"attachment"}).success(h(a)).progress(function(e){r.selectedFiles[a].progress=parseInt(e.loaded/e.total*100,10)}).error(u(a)))}else s.simple({locals:{_header:"Too big",_body:"Your file is too big"}})}),r.closePopover()},r.chooseFromDropbox=function(){i.Dropbox.choose({success:function(e){r.$apply(function(){angular.forEach(e,function(e){if(e.bytes<=n.USER_MAX_FILE_UPLOAD){var t=o.get("FileUpload",{file:e,progress:-1,dataUrl:null}),i=r.selectedFiles.push(t)-1,l=o.get("WebStorageUpload",{type:"dropbox",name:e.name,size:e.bytes,file_key:e.link});r.requestWatch.wait(a({method:"POST",url:c,data:l.toFormData(),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(h(i)).error(u(i)))}else s.simple({locals:{_header:"Too big",_body:"Your file is too big"}})})})},linkType:"direct",multiselect:!0}),r.closePopover()},r.removeSelectedFile=function(e){r.selectedFiles.splice(e,1),p(r.uploadedFiles)}}],templateUrl:"FileUploadList.tmpl.html"}}b.$inject=["$templateCache"],z.$inject=["eoUpload","eoConfig","$window","$http","eoModelFactory","eoBlockWatcher","DROPBOX_APP_KEY","eoModal","FILE_UPLOAD_URL","DROPBOX_UPLOAD_URL","$document"];const U='<input type="file" eo-file-select="fileSelected($files, $event)" id="{{inputId}}"> <div ng-cloak ng-repeat="file in files" eo-image-drop-preview="file"> <div data-eo-block="{{file.status == \'loading\'}}" data-message=""> <img ng-src="{{file.preview}}" class="status-{{file.status}}"> <a class="remove" ng-if="file.status != \'loading\'" href="#" ng-click="removeFile($index)"><span aria-hidden="true" class="glyphicon air-icon-delete m-0"></span></a> </div> </div> <div class="message" ng-class="{notempty: files.length}"><ng-transclude></ng-transclude></div> ',P=angular.module("components.uploading.uploaders.imageDrop",[n.name,R,t.name]).run(M).constant("IMAGEDROP_UPLOAD_URL","/upload").constant("IMAGE_ACCEPTED_TYPES",{"image/png":!0,"image/jpeg":!0,"image/gif":!0}).directive("eoImageDrop",$).directive("eoImageDropPreview",E);function M(e){e.put("ImageDrop.tmpl.html",U)}function $(e,t,i,a,o,r,n,s){return{restrict:"A",templateUrl:"ImageDrop.tmpl.html",require:"?^ngModel",transclude:!0,scope:{onSelect:"&eoImageDrop",onUpload:"&eoImageDropOnUpload",onError:"&eoImageDropOnError",onProgress:"&eoImageDropOnProgress",inputId:"@eoImageDropInputId"},link:function(e,t,l,c){var p="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";e.files=[];var h=function(t){e.files=t,c?c.$setViewValue(e.files):e.$$phase&&e.$apply()},u=s||{};t.addClass("eo-image-drop");var d=t.find("input"),g=t;function f(t,r,s){angular.forEach(t,function(t){!function(t,a){if("undefined"!==i.FileReader&&!0===u[t.type]){var r=new FileReader;r.addEventListener("load",function(i){var r=i.target.result,n={preview:p,original:p,status:"loading",file:t,setStatus:function(e){this.status=e},setResult:function(e){this.result=e}};e.files.push(n),h(e.files),e.$apply();var s=e.files.length-1;o.applyRotationFromEXIF(t,r,function(t,i){e.files[s].preview=i,e.files[s].file=o.dataURItoBlob(n.original),h(e.files),e.$apply(),a&&a(n)})}),r.readAsDataURL(t)}}(t,function(i){!function(t,i){a.upload({url:n,file:t,data:{}}).then(function(i){return e.onUpload({$file:t,$result:i}),h(e.files),i},function(i){return e.onError({$file:t,$result:i}),h(e.files),i}).then(function(){i.setStatus("success")}).catch(function(){i.setStatus("error")}).finally(function(e){i.setResult(e)})}(t,i)})}),e.onSelect({$event:s,$files:t}),!1!==r&&e.$apply()}l.eoUploadLink&&(g=angular.element(t[0].querySelector(l.eoUploadLink))),g.on("click",function(){d[0].click()}),e.removeFile=function(t){e.files.splice(t,1),h(e.files)},e.fileSelected=function(e,t){f(e,!1,t)},i.FileReader&&function(){var e=r[0].createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}&&(t.on("dragover",function(e){t.addClass("dragover"),e.stopPropagation(),e.preventDefault()}),t.on("dragleave",function(e){t.removeClass("dragover"),e.stopPropagation(),e.preventDefault()}),t.on("drop",function(e){t.removeClass("dragover"),e.stopPropagation(),e.preventDefault();var i=null;e.dataTransfer?i=e.dataTransfer.files:e.originalEvent&&e.originalEvent.dataTransfer&&(i=e.originalEvent.dataTransfer.files),f(i,!1,e)}))}}}function E(e){return{restrict:"A",scope:!0,link:function(t,i,a){var o=e(a.eoImageDropPreview),r=o(t);r.id="eo-image-drop-preview-"+t.$id,o.assign(t,r),i.addClass("eo-image-drop-preview"),i.attr("id","eo-image-drop-preview-"+t.$id)}}}M.$inject=["$templateCache"],$.$inject=["$parse","$compile","$window","eoUpload","eoImageHelper","$document","IMAGEDROP_UPLOAD_URL","IMAGE_ACCEPTED_TYPES"],E.$inject=["$parse"];const T='<div class="eo-profile-image-upload" data-eo-block="{{watcher.pending}}"> <div class="row"> <div class="col-xs-7"> <div class="column-wrapper-left" ng-class="{\'hidden\':getFileSelectionStatus()}"> <div class="drop-box" eo-file-drop="onFileSelect($files, $event)"> Drop files here </div> <div> <p>Select one file:</p> <input type="file" eo-file-select="onFileSelect($files, $event)" accept="{{imageAccept}}"> </div> </div> <div class="column-wrapper-left" ng-class="{\'hidden\':!getFileSelectionStatus()}"> <div class="crop-area-container"> <eo-image-crop class="crop-area-wrapper" image="dataImg.orig" result-image="dataImg.cropped" crop-coord="cropCoord" area-type="{{areaType}}" result-image-aspect="{{resultImageAspect}}"></eo-image-crop> </div> <p>Drag frame to adjust portrait.</p> <a href="javascript:;" ng-click="uploadNewImage();">Upload a different photo</a> </div> </div> <div class="col-xs-5 column-wrapper-right column-divider-left"> <div class="m-lg-left-right"> <p class="form-title">Your profile portrait</p> <div class="avatar-wrapper"> <img ng-src="{{dataImg.cropped}}" ng-class="{\'circle\': \'glyphicon air-icon-avatar\', \'square\': \'avatar-company width-xs m-0\'}[areaType]" class="avatar avatar-100"> </div> <p>Must be an actual picture of you! Logos, clip-art, group pictures, and digitally-altered images not allowed.</p> <button class="btn btn-primary m-0-left" ng-click="uploadImage()" ng-disabled="!getFileSelectionStatus()">Save</button> <button class="btn btn-link btn-sm" ng-click="cancel()">Cancel</button> </div> </div> </div> \x3c!-- Guide image is not visible right away but used here to be loaded later on the canvas of cropping tool. --\x3e \x3c!-- Guide image is expected to have 1x1 aspect ratio --\x3e <img class="profile_image_outline" src=\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 690 690"> <g fill="#6fda44"> <path d="M448.454 191.36c-27.45-35.908-64.222-55.59-103.325-55.59-39.11 0-75.88 19.768-103.33 55.59-27.11 35.392-42.04 82.263-42.04 132.156s14.93 96.678 42.04 132.07c27.45 35.908 64.22 55.59 103.32 55.59 39.1 0 75.872-19.768 103.322-55.59 27.103-35.392 42.04-82.264 42.04-132.156 0-49.893-14.937-96.678-42.04-132.07zM345.13 498.228c-73.027 0-132.415-78.378-132.415-174.797 0-96.42 59.388-174.79 132.414-174.79 73.02 0 132.41 78.38 132.41 174.8 0 96.42-59.39 174.8-132.42 174.8z"/> <path d="M502.75 632.368c-42.298-26.76-53.174-37.463-55.936-41.52-8.632-12.69-3.194-44.886.26-59.13 11.91-9.753 23.046-21.406 33.232-34.613 35.564-46.44 55.158-108.072 55.158-173.59 0-65.516-19.594-127.148-55.158-173.588-35.995-47.044-83.99-72.94-135.177-72.94-51.19 0-99.19 25.896-135.18 72.854-35.57 46.44-55.16 108.08-55.16 173.59 0 65.52 19.59 127.15 55.16 173.59 10.01 13.04 20.97 24.52 32.63 34.19.95 3.97 2.93 13.038 4.14 23.31 1.9 17.005.6 29.867-3.71 36.255-2.68 3.97-13.55 14.76-55.94 41.52-24.516 15.537-47.82 28.916-47.994 29.003l6.474 11.22c9.667-5.522 94.95-54.81 108.244-74.492 6.217-9.15 8.2-24.34 5.87-44.97-.43-3.627-.95-7.166-1.465-10.36 26.584 17.696 56.192 27.02 87.01 27.02 30.555 0 60.076-9.238 86.49-26.76-.518 3.107-1.036 6.473-1.38 10.013-2.33 20.63-.346 35.734 5.87 44.97 13.292 19.68 98.576 68.97 108.243 74.493l6.475-11.22c-.43.087-23.65-13.293-48.167-28.83zM167.742 323.43c0-128.79 79.586-233.495 177.386-233.495S522.515 194.64 522.515 323.43c0 128.79-79.586 233.494-177.387 233.494-97.8 0-177.387-104.705-177.387-233.494z"/> </g> </svg>\'> </div> ',O=angular.module("components.uploading.uploaders.profileImage",[n.name,d.name,t.name,a,R]).run(L).constant("PROFILE_IMAGE_AREA_TYPE","circle").constant("PROFILE_IMAGE_UPLOAD_URL","/upload").constant("PROFILE_IMAGE_TYPE_REGEXP",/^image\/(png|gif|jpeg)$/).constant("PROFILE_IMAGE_ACCEPT","image/png,image/gif,image/jpeg").config(H).service("eoTemplateImage",k).directive("eoProfileImageUploader",N);function L(e){e.put("ProfileImageUploader.tmpl.html",T)}function H(e,t){e.decorator("cropCanvas",["$delegate","eoTemplateImage",function(e,i){var a=i.get("profile_image_outline");return function(i){return e.call(this,i),this.drawCropArea=function(e,o,r,n,s){var l=Math.floor(r*(n[1]/n[0])),c=e.width/i.canvas.width,p=e.height/i.canvas.height,h=o[0]-r/2,u=o[1]-l/2;if(i.save(),i.setLineDash([5]),i.strokeStyle=t.areaOutline,i.lineWidth=2,i.beginPath(),s(i,o,r,l),i.stroke(),i.clip(),r>0){var d=h*c,g=u*p,f=r*c,m=l*p;i.drawImage(e,d,g,f,m,h,u,r,l),this.setCropCoord(d,g,f,m)}i.beginPath(),s(i,o,r,l),i.stroke(),i.clip(),i.restore(),function(e,t,i,o){if(a){var r=i>o?o:i,n=t[0]-i/2,s=t[1]-o/2;e.save(),e.globalAlpha=.8,e.drawImage(a,n,s,r,r),e.restore()}}(i,o,r,l)},this.drawIconResizeCircle=function(e,a){i.save(),i.strokeStyle=t.resizeCircleStroke,i.lineWidth=1,i.fillStyle=t.resizeCircleFill,i.beginPath(),i.fillRect(e[0]-a/2,e[1]-a/2,a,a),i.strokeRect(e[0]-a/2,e[1]-a/2,a,a),i.fill(),i.stroke(),i.closePath(),i.restore()},this}}])}function k(){var e={};this.set=function(t,i){e[t]=i},this.get=function(t){return e[t]}}function N(e,t,i,a,o,r,n,s,l){return{templateUrl:"ProfileImageUploader.tmpl.html",scope:{onCancel:"&",onSuccess:"&",onError:"&",onProgress:"&",onSaveImage:"&",returnOriginalImage:"@",imageUrl:"=?",uploadUrl:"=?",uploadUnchangedImage:"@",areaType:"@",resultImageAspect:"@"},link:function(e,t){e.uploadNewImage=function(){e.dataImg.isFileSelected=!1,e.dataImg.orig=null,angular.element(t).find("input").val(null)};var i=t[0].querySelector(".profile_image_outline");i&&l.set("profile_image_outline",i)},controller:["$scope","PROFILE_IMAGE_ACCEPT",function(l,c){var p="false"!==l.returnOriginalImage,h="true"===l.uploadUnchangedImage,u=r.get("UploadTypeException");l.imageAccept=c,l.isFileChanged=!1,l.watcher=new n,l.areaType=l.areaType||t,l.dataImg={file:null,orig:"",cropped:"",isFileSelected:!1,isFileChanged:!1},l.$watch("imageUrl",function(e){e&&l.watcher.wait(o.loadImageByUrl(e).then(function(t){l.dataImg.file=o.dataURItoBlob(t),l.dataImg.file.name=e.substring(e.lastIndexOf("/")+1),l.dataImg.isFileSelected=!0,l.dataImg.orig=t},function(e){l.onError({result:e})},function(e){l.onProgress({event:e})}))}),l.onFileSelect=function(e){var t=e[0];if(t)if(a.test(t.type)){l.dataImg.file=t,l.dataImg.isFileSelected=!0;var i=new FileReader;i.onload=function(e){l.dataImg.isFileChanged=!0,l.$apply(function(){l.dataImg.orig=e.target.result})},i.onprogress=function(e){l.onProgress({event:e})},i.readAsDataURL(t)}else l.onError({result:new u({message:"Only images can be selected"})})},l.getFileSelectionStatus=function(){return l.dataImg.isFileSelected},l.cancel=function(){l.onCancel()},l.uploadImage=function(){var t=void 0;l.dataImg.isFileChanged&&((t=o.dataURItoBlob(l.dataImg.cropped,{type:l.dataImg.file.type})).name=l.dataImg.file.name),l.onSaveImage();var a=p?l.dataImg.file:t;e.upload({url:l.uploadUrl?l.uploadUrl:i,file:l.dataImg.isFileChanged||h?a:null,data:{cropCoord:angular.toJson(s.get())}}).then(function(e){l.dataImg.isFileChanged=!1,l.onSuccess({result:e})},function(e){l.onError({result:e})},function(e){l.onProgress({event:e})})}}]}}L.$inject=["$templateCache"],H.$inject=["$provide","PROFILE_IMAGE_CROP_TOOL_COLORS"],k.$inject=[],N.$inject=["eoUpload","PROFILE_IMAGE_AREA_TYPE","PROFILE_IMAGE_UPLOAD_URL","PROFILE_IMAGE_TYPE_REGEXP","eoImageHelper","eoModelRegistry","eoBlockWatcher","eoImageCropCoord","eoTemplateImage"];var B=function(e){if("number"!=typeof e||isNaN(e))throw new TypeError("Expected a number, got "+typeof e);var t=e<0,i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];t&&(e=-e);if(e<1)return(t?"-":"")+e+" B";var a=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),i.length-1);e=Number(e/Math.pow(1e3,a));var o=i[a];return e>=10||e%1==0?(t?"-":"")+e.toFixed(0)+" "+o:(t?"-":"")+e.toFixed(1)+" "+o};const G='<div class="file-upload-btn-wrapper" ng-class=\'{"file-uploaded" : $ctrl.files.length}\'> <label for="file-upload-el" class="file-input btn btn-sm btn-default m-0"> <span aria-hidden="true" class="glyphicon air-icon-attach m-0-left"></span>Attach files <input type="file" id="file-upload-el" name="fileInput" ng-model="fileInputModel" eo-file-select="$ctrl.handleFileSelect($files)"> </label> </div> <div class="file-upload-list-wrapper"> <eo-attachment ng-repeat="file in $ctrl.files" eo-file="file" eo-file-retry-upload="$ctrl.uploadFile(file)" eo-file-remove="$ctrl.removeFile(file)"></eo-attachment> </div>',X='<div class="d-flex align-items-center m-0 file-list-item"> <div class="file-name-block min-width-0"> <div class="d-flex align-items-center" ng-class=\'{ "text-muted": $ctrl.file.isUploading }\'> <span aria-hidden="true" class="glyphicon air-icon-attach m-0-left"></span> <p class="d-flex m-0 min-width-0"> <span class="ellipsis">{{$ctrl.file.fileFirstName}}</span> <span class="nowrap">{{$ctrl.file.fileLastName}}</span> </p> <span class="m-xs-left-right nowrap">({{$ctrl.file.formattedSize}})</span> </div> <label class="form-message form-error m-xs-top" ng-if="$ctrl.file.isMaxSizeExceeded || $ctrl.file.isFileUnsupported || $ctrl.file.isUploadFailed"> <span class="glyphicon air-icon-exclamation-circle" aria-hidden="true"></span> <span ng-if="$ctrl.file.isMaxSizeExceeded">File is too large</span> <span ng-if="$ctrl.file.isFileUnsupported">File type is not supported</span> <span ng-if="$ctrl.file.isUploadFailed">Upload failed</span> </label> <div class="m-xs-top" ng-if="$ctrl.file.isUploading"> <eo-progressbar value="$ctrl.file.uploadProgress" full-width="true"></eo-progressbar> </div> </div> <div class="file-remove-block" ng-click="$ctrl.onActionBtnClick()"> <button class="btn btn-default btn-circle btn-sm"> <span aria-hidden="true" class="glyphicon" ng-class=\'{"air-icon-refresh": $ctrl.file.isUploadFailed, "air-icon-delete": !$ctrl.file.isUploadFailed}\'></span> <span class="sr-only" ng-if="$ctrl.file.isUploadFailed">Retry</span> <span class="sr-only" ng-if="!$ctrl.file.isUploadFailed">Delete</span> </button> </div> </div> ',j=angular.module("components.uploading.uploaders.attachFiles",[n.name,"components.core.progressbar"]).constant("ATTACH_FILES_CONFIG",{url:"/upload"}).component("eoAttachFiles",{require:{ngModelCtrl:"ngModel"},bindings:{ngModel:"<",maxFileSize:"<eoMaxFileSize",unsupportedFiles:"<eoUnsupportedFileTypes",fileUploadOptions:"<eoFileUploadOptions",onFileUpload:"&eoOnFileUpload",onFileRemove:"&eoOnFileRemove"},template:G,controller:W}).component("eoAttachment",{bindings:{file:"<eoFile",fileRemove:"&eoFileRemove",retryUpload:"&eoFileRetryUpload"},template:X,controller:Y});function W(e,t){var i=this;function a(){var e=[];i.files.forEach(function(t){t.isFileUnsupported||t.isMaxSizeExceeded||t.isUploading||t.isUploadFailed||e.push(t)}),i.ngModel&&(i.ngModel=e)}function o(e){var t=e.name.lastIndexOf(".");t>10&&(t-=5),e.formattedSize=B(e.size),e.fileLastName=e.name.substring(t,e.name.length),e.fileFirstName=e.name.substring(0,t)}i.files=[],i.fileUploadOptions||(i.fileUploadOptions={}),i.handleFileSelect=function(e){e.length&&e.forEach(function(e){o(e),i.maxFileSize&&i.maxFileSize<e.size?e.isMaxSizeExceeded=!0:i.unsupportedFiles&&i.unsupportedFiles.length&&i.unsupportedFiles.indexOf(e.type)>=0?e.isFileUnsupported=!0:i.uploadFile(e),i.files.push(e)})},i.removeFile=function(e){var t=i.files.indexOf(e);e.xhr&&e.xhr.abort();i.files.splice(t,1),a(),i.onFileRemove&&i.onFileRemove({$file:i.files[t]})},i.uploadFile=function(o){o.isUploading=!0,delete o.isUploadFailed,o.uploadProgress=0,o.xhr=e.upload({url:i.fileUploadOptions.url||t.url,file:o,data:i.fileUploadOptions.data||{}}).success(function(e){var t=null;if(e.constructor===String){var r=e.replace(/(<([^>]+)>)/gi,"");t=JSON.parse(r)}else t=e;200===t.code||201===t.code?i.onFileUpload&&(a(),i.onFileUpload({$file:o})):o.isUploadFailed=!0}).progress(function(e){o.uploadProgress=parseInt(e.loaded/e.total*100,10)}).error(function(){o.isUploadFailed=!0}).finally(function(){delete o.isUploading,delete o.xhr})},i.ngModel.length?i.ngModel.forEach(function(e){o(e),i.files.push(e)}):i.ngModel=[]}function Y(){var e=this;e.onActionBtnClick=function(){e.file.isUploadFailed?e.retryUpload({file:e.file}):e.fileRemove({file:e.file})}}W.$inject=["eoUpload","ATTACH_FILES_CONFIG"],Y.$inject=[],angular.module("components.uploading.uploaders",[A.name,P.name,O.name,j.name])}();
//# sourceMappingURL=uploading.12.3.0.min.js.map
